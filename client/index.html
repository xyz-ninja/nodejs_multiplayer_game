<canvas id="ctx" width="500" height="500" style="border:1px solid #111">
</canvas>

<script src="/libs/socketio.js"></script>
<script>

    var ctx = document.getElementById("ctx").getContext("2d");
    ctx.font = '30px Arial';

    const WIDTH = 500;
    const HEIGHT = 500;

    const socket = io();

    socket.on('newPositions', function(data) {
        ctx.clearRect(0, 0, WIDTH, HEIGHT);

		// update players
        for (let i = 0; i < data.players.length; i++) {
            let currentData = data.players[i];
            ctx.fillText(currentData.number, currentData.x, currentData.y);
        }

		// update bullets
		for (let i = 0; i < data.bullets.length; i++) {
            let currentData = data.bullets[i];
            ctx.fillRect(currentData.x - 5, currentData.y - 5, 10, 10);
        }
    });

    // update input
    document.onkeydown = function(event) {
        let inputID = "";

        if (event.keyCode === 68) {
            inputID = "right";
        } else if (event.keyCode === 83) {
            inputID = "down";
        } else if (event.keyCode === 65) {
            inputID = "left";
        } else if (event.keyCode === 87) {
            inputID = "up";
        }

        if (inputID != "") {
            socket.emit('keyPress', {inputID: inputID, state: true});
        }
    }

    document.onkeyup = function(event) {
        let inputID = "";
        if (event.keyCode === 68) {
            inputID = "right";
        } else if (event.keyCode === 83) {
            inputID = "down";
        } else if (event.keyCode === 65) {
            inputID = "left";
        } else if (event.keyCode === 87) {
            inputID = "up";
        }

        if (inputID != "") {
            socket.emit('keyPress', {inputID: inputID, state: false});
        }
    }

</script>